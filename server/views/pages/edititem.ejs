<!DOCTYPE html>
<html lang="en">
  <head>
    <title><%= title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <%- include('../partials/stylesheet')%>
    
    <style>
        .sell-image-box {
            min-height: 300px;
            max-height: 310px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            padding: 20px;
            overflow:hidden;    
            
        }
        .sell-image-box img{
            height:100%;
            width:100%;
            display: block;
            object-fit: cover;
        }
    </style>

  </head>
  <body>
  
  <div class="site-wrap">
    <%- include('../partials/header-shop')%>

    <div class="site-section">
        <div class="container">
          <div class="row mb-5">
            <div class="col-md-12">
              <div class="border p-4 rounded" role="alert">
                Have an established brand? <a href="/brand">Click here</a> to start listing under your brand name!
              </div>
            </div>
          </div>

          <form action="<%=item._id%>" method='post' enctype="multipart/form-data">

          <div class="row">
            
            <div class="col-md-12 mb-12 mb-md-12">
              <h2 class="h3 mb-3 text-black">Edit Listing</h2>
              <div class="p-3 p-lg-5">
                <div class="form-group">
                    <label for="c_country" class="text-black">Are you selling as an Individual or a Brand Owner <span class="text-danger">*</span></label>
                    <p class="mb-3">The Brand option will allow more options to sell your products such as Brand name, Brand image</p>
                    <select class="form-control">
                        <option value="1">-- Choose One --</option>
                        <option value="2" id="sell_individual_hidden">Individual</option>    
                        <option value="3">Brand</option>      
                    </select>
                </div>


            
                <div class='p-3 p-lg-5 border'>
                  <h3 class="h3 mb-3 text-black">Photos</h3>
                  <div class="row">
                    <div class='col-6 col-xs-6 col-sm-4 col-md-4 col-lg-3 sell-image-box'>
                        <label for='image0' style='cursor:pointer;'>
                            Image 1
                            <% if (item.images[0]) { %>
                            <img src='<%=item.images[0].data%>' class='img-thumbnail' id='image0Preview'>
                            <% } else { %>
                            <img src='/uploads/default/defaultItemImg.png' class='img-thumbnail' id='image0Preview'>
                            <% } %>
                        </label>
                        <input class='hidden' type='file' hidden id='image0' name='images'>
                    </div>
                    <div class='col-6 col-xs-6 col-sm-4 col-md-4 col-lg-3 sell-image-box'>
                        <label for='image1' style='cursor:pointer;'>
                            Image 2
                            <% if (item.images[1]) { %>
                                <img src='<%=item.images[1].data%>' class='img-thumbnail' id='image1Preview'>
                                <% } else { %>
                                <img src='/uploads/default/defaultItemImg.png' class='img-thumbnail' id='image1Preview'>
                                <% } %>
                        </label>
                        <input class='hidden' type='file' hidden id='image1' name='images' disabled>
                    </div>
                    <div class='col-6 col-xs-6 col-sm-4 col-md-4 col-lg-3 sell-image-box'>
                        <label for='image2' style='cursor:pointer;'>
                            Image 3
                            <% if (item.images[2]) { %>
                                <img src='<%=item.images[2].data%>' class='img-thumbnail' id='image2Preview'>
                                <% } else { %>
                                <img src='/uploads/default/defaultItemImg.png' class='img-thumbnail' id='image2Preview'>
                                <% } %>
                        </label>
                        <input class='hidden' type='file' hidden id='image2' name='images' disabled>
                    </div>
                    <div class='col-6 col-xs-6 col-sm-4 col-md-4 col-lg-3 sell-image-box'>
                        <label for='image3' style='cursor:pointer;'>
                            Image 4
                            <% if (item.images[3]) { %>
                                <img src='<%=item.images[03].data%>' class='img-thumbnail' id='image3Preview'>
                                <% } else { %>
                                <img src='/uploads/default/defaultItemImg.png' class='img-thumbnail' id='image3Preview'>
                                <% } %>
                        </label>
                        <input class='hidden' type='file' hidden id='image3' name='images' disabled>
                    </div>
                    </div>
                </div>

                <br/>
                <div class='p-3 p-lg-5 border'>
                  <h3 class="h3 mb-3 text-black">Listing Details</h3>
                  <p class="mb-3">Tell the world all about your item and why they’ll love it.</p>
                  <div class="form-group row">
                      <div class="col-md-12">
                          <label for="title" class="text-black">Title </label>
                          <p class="mb-3">Include keywords that buyers would use to search for your item.</p>
                          <input type="text" class="form-control" id="title" name="title" value="<%=item.main.title %>" required>
                      </div>
                  </div>

                  <div class="form-group row">
                      <div class="input-group">
                          <div class='col-md-6'>
                              <label for="category">Category</label><br/>
                              <p class="mb-3">Type a two- or three-word description of your item to get category suggestions that will help more shoppers find it</p>
                              <input type="text" class="form-control" id="category" name="category" value="<%=item.main.category %>">
                          </div>
                      </div>
                  </div>

                  <div class="form-group row">
                      <div class="col-md-12">
                          <label for="desc" class="text-black">Description </label>
                          <p class="mb-3">Start with a brief overview that describes your item’s finest features. Shoppers will only see the first few lines of your description at first, so make it count!</p>
                          <textarea name="desc" id="desc" cols="30" rows="5" class="form-control" placeholder="Write your item description here..." required><%=item.main.desc %></textarea>
                      </div>
                  </div>

                </div>

                <br/>

                  <div class='p-3 p-lg-5 border'>
                      <h3 class="h3 mb-3 text-black">Stock Keeping & Pricing</h3>
                      <div class="form-group row">
                          <div class="col-md-6">
                              <label for="price" class="text-black">Price</label>
                              <p class="mb-3">Remember to factor in the costs of materials, labour, and other business expenses. If you offer free delivery, make sure to include the cost of postage so it doesn't eat into your profits.</p>
                              <input type="text" class="form-control" id="price" name="price" placeholder="S$" value="<%=item.stock.price %>" required>
                          </div>
                      </div>

                      <div class="form-group row">
                          <div class="col-md-6">
                              <label for="quantity" class="text-black">Quantity</label>
                              <p class="mb-3">For quantities greater than one, this listing will renew automatically until it sells out. You’ll be charged a USD 0.20 USD listing fee each time.</p>
                              <input type="text" class="form-control" id="quantity" name="quantity" placeholder="1" value="<%=item.stock.quantity %>" required>
                          </div>
                      </div>
                  </div>

                  <br/>

                  <div class='p-3 p-lg-5 border'>
                      <h3 class="h3 mb-3 text-black">Delivery</h3>
                      <div class="form-group row">
                          <div class="col-md-12">
                              <label for="countryOrigin" class="text-black">Country of origin </label>
                              <p class="mb-3">The country you're dispatching from</p>
                              <input type="text" class="form-control" id="countryOrigin" name="countryOrigin" placeholder="Singapore" value="<%=item.delivery.countryOfOrigin %>" required>
                          </div>
                      </div>

                      <div class="form-group row">
                          <div class="col-md-6">
                              <label for="processingTime" class="text-black">Processing Time</label>
                              <p class="mb-3">Once a buyer has placed their order, how long does it take you to prepare, package, and put it in the mail?</p>
                              <div class="input-group">
                                  <div class='col-md-6'>
                                      <label for="itemCat">From</label><br/>
                                      <select class="form-control" name="processingTimeFrom">
                                          <option value="0">-- Choose One --</option>
                                          <option value="1" <% if (item.delivery.processingTimeFrom == 1) { %> selected <% } %>>1</option>    
                                          <option value="2" <% if (item.delivery.processingTimeFrom == 2) { %> selected <% } %>>2</option>
                                          <option value="3" <% if (item.delivery.processingTimeFrom == 3) { %> selected <% } %>>3</option>   
                                          <option value="4" <% if (item.delivery.processingTimeFrom == 4) { %> selected <% } %>>4</option>   
                                          <option value="5" <% if (item.delivery.processingTimeFrom == 5) { %> selected <% } %>>5</option>   
                                          <option value="6" <% if (item.delivery.processingTimeFrom == 6) { %> selected <% } %>>6</option>     
                                          <option value="7" <% if (item.delivery.processingTimeFrom == 7) { %> selected <% } %>>7</option>   
                                          <option value="8" <% if (item.delivery.processingTimeFrom == 8) { %> selected <% } %>>8</option>   
                                          <option value="9" <% if (item.delivery.processingTimeFrom == 9) { %> selected <% } %>>9</option>
                                          <option value="10" <% if (item.delivery.processingTimeFrom == 10) { %> selected <% } %>>10</option>  
                                      </select>
                                  </div>
                                  <div class='col-md-6'>
                                      <label for="itemCat">To</label><br/>
                                      <select class="form-control" name="processingTimeTo">
                                          <option value="0">-- Choose One --</option>
                                          <option value="1" <% if (item.delivery.processingTimeTo == 1) { %> selected <% } %>>1</option>    
                                          <option value="2" <% if (item.delivery.processingTimeTo == 2) { %> selected <% } %>>2</option>
                                          <option value="3" <% if (item.delivery.processingTimeTo == 3) { %> selected <% } %>>3</option>   
                                          <option value="4" <% if (item.delivery.processingTimeTo == 4) { %> selected <% } %>>4</option>   
                                          <option value="5" <% if (item.delivery.processingTimeTo == 5) { %> selected <% } %>>5</option>   
                                          <option value="6" <% if (item.delivery.processingTimeTo == 6) { %> selected <% } %>>6</option>     
                                          <option value="7" <% if (item.delivery.processingTimeTo == 7) { %> selected <% } %>>7</option>   
                                          <option value="8" <% if (item.delivery.processingTimeTo == 8) { %> selected <% } %>>8</option>   
                                          <option value="9" <% if (item.delivery.processingTimeTo == 9) { %> selected <% } %>>9</option>
                                          <option value="10" <% if (item.delivery.processingTimeTo == 10) { %> selected <% } %>>10</option> 
                                      </select>
                                  </div>
                              </div>
                              <div class="input-group">
                                  <input type="radio" name="processingTimeRadio" value="days" <% if (item.delivery.processingTimeMode == "days") { %> checked <% } %>>Business days
                                  <input type="radio" name="processingTimeRadio" value="weeks"  <% if (item.delivery.processingTimeMode == "weeks") { %> checked <% } %>>Weeks
                              </div>
                          </div>

                      </div>
                  </div>

                  <br/>

                    <div class="form-group row">
                        <div class="col-md-6">
                            <button class="btn btn-primary btn-lg py-3 btn-block">Update Listing</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" class="btn btn-danger btn-lg py-3 btn-block" onclick="deleteItem(`<%=item._id %>`)">Delete Listing</button>
                        </div>
                    </div>
                </div>
            </div>
  
            </div>
          </div>
        </form>
        </div>
      </div>
      
      <!-- Confirm Delete Modal -->
    <div class="modal" id="deleteItemModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content form-wrapper">
            <div class="close-box" data-dismiss="modal">
              <i class="icon icon-times icon-2x"></i>
            </div>
            <div class="container-fluid">
              <div class="form-group text-center">
                <h4>Confirm Item Deletion </h4>
              </div>
  
              <div class="form-group row">
                <div class="col-md-6">
                    <button id="deleteConfirm" class="btn btn-danger py-3 btn-block">Confirm</button>
                </div>
                <div class="col-md-6">
                    <button id="cancelDeleteItem" class="btn btn-secondary py-3 btn-block">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    <%- include('../partials/footer') %>
  
  </div>

  <%- include('../partials/javascript') %>

  <script>
        // Image stuff
        var image0 = $('#image0')
        var image1 = $('#image1')
        var image2 = $('#image2')
        var image3 = $('#image3')
        var ValidImageTypes = ['png','jpg','jpeg']
        image0.on('change',function (){
            var fileType = $(this).val().substr($(this).val().length-3,$(this).val().length)
            if (!ValidImageTypes.includes(fileType) ){
                $(this).val('');
                $("#vidHide").hide();
                $("#descHide").hide();
                $("#prevHide").hide();
                $("#image0Preview").attr("src","/uploads/default/defaultItemImg.jpg");
                $("#prevImg").attr("src","/uploads/default/defaultItemImg.jpg");
                alert('Image type should be png, jpg or jpeg!');
            } else {
                var reader = new FileReader();
                reader.onload = function (e) {
                        // get loaded data and render thumbnail.
                        $("#image0Preview").attr("src",e.target.result);
                        $("#prevImg").attr("src",e.target.result);
                    };
                // read the image file as a data URL.
                reader.readAsDataURL(this.files[0]);
            
                $("#vidHide").show();
                $("#descHide").show();
                $("#prevHide").show();
            }
            image1.prop('disabled',false)
            image2.prop('disabled',false)
            image3.prop('disabled',false)
        })
        image1.on('change',function (){
            var fileType = $(this).val().substr($(this).val().length-3,$(this).val().length)
            if (!ValidImageTypes.includes(fileType)){
                $(this).val('');
                $("#image1Preview").attr("src","/uploads/default/defaultItemImg.jpg");
                alert('Image type should be png, jpg or jpeg!');
            } else {
                var reader = new FileReader();
                reader.onload = function (e) {
                        // get loaded data and render thumbnail.
                        $("#image1Preview").attr("src",e.target.result);
                    };
                // read the image file as a data URL.
                reader.readAsDataURL(this.files[0]);
            }
        })
        image2.on('change',function (){
            var fileType = $(this).val().substr($(this).val().length-3,$(this).val().length)
            if (!ValidImageTypes.includes(fileType)){
                $(this).val('');
                $("#image2Preview").attr("src","/uploads/default/defaultItemImg.jpg");
                alert('Image type should be png, jpg or jpeg!');
            } else {
                var reader = new FileReader();
                reader.onload = function (e) {
                        // get loaded data and render thumbnail.
                        $("#image2Preview").attr("src",e.target.result);
                    };
                // read the image file as a data URL.
                reader.readAsDataURL(this.files[0]);
            }
        })
        image3.on('change',function (){
            var fileType = $(this).val().substr($(this).val().length-3,$(this).val().length)
            if (!ValidImageTypes.includes(fileType)){
                $(this).val('');
                $("#image3Preview").attr("src","/uploads/default/defaultItemImg.jpg");
                alert('Image type should be png, jpg or jpeg!');
            } else {
                // Replace picture on upload
                var reader = new FileReader();
                reader.onload = function (e) {
                        // get loaded data and render thumbnail.
                        $("#image3Preview").attr("src",e.target.result);
                    };
                // read the image file as a data URL.
                reader.readAsDataURL(this.files[0]);
            }
        })

    function deleteItem(id) {  
      $('#deleteItemModal').modal();

      $('#cancelDeleteItem').click(function(e) {
        $('.close-box').click();
        $('#deleteConfirm').off('click');
      })
      
      $('#deleteConfirm').click(function(e) {
        $.ajax({
        type: "POST",
        url: '/item/delete/'+id,
        data: JSON.stringify({ id: id }),
        contentType: 'application/json; charset=utf-8',
        success: function (data) {
          if (data.status === "Success") {
            window.location = data.redirect;
          }
        },
        error: function (error) {

        }
      });
      })
      
    }
  </script>

    
  </body>
</html>